{% extends "layout.html" %}
{% block content %} 
    <legend class="border-bottom mb-4">Execution Results</legend>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style type="text/css">
        <!--
         .tab { margin-left: 40px; }
        -->
    </style>

    <article class="card md-3">
        <div class="card-body">
            <p class="markdown-body" id="result_content" class="tab" style="font-family:monospace; font-size:16px">
                <strong>Waiting for a response from a judging server...</strong>
            </p>
        </div>    
    </article>

    <script>
        var x = setInterval(function() {
            const Http = new XMLHttpRequest();
            const url='https://dboj.jimmyliu.dev/raw_submission/{{sub_id}}';
            Http.open("GET", url);
            Http.send();

            Http.onreadystatechange = (e) => {
                var response = Http.responseText;
                if (response.length > 0) {
                    document.getElementById('result_content').innerHTML = Http.responseText.replaceAll("      ", "&emsp;&emsp;&emsp;&emsp;").replace("EXECUTION RESULTS", "").replaceAll("  ", "&emsp;").replaceAll("%nl%", "<br>");
                }
                if (response.endsWith("(Status: COMPLETED)")) {
                    clearInterval(x);
                }
            }
        }, 1000);
    </script>

{% endblock content %}
